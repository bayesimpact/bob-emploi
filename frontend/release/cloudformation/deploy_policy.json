{
  "AWSTemplateFormatVersion": "2010-09-09",
  "Resources": {
    "ManagedDeployPolicy": {
      "Type": "AWS::IAM::ManagedPolicy",
      "Properties": {
        "Groups": [
          "BobProdDeploy"
        ],
        "PolicyDocument": {
          "Version": "2012-10-17",
          "Statement": [
            {
              "Effect": "Allow",
              "Action": [
                "cloudformation:CreateChangeSet",
                "cloudformation:DescribeChangeSet",
                "cloudformation:DescribeStacks",
                "cloudformation:ExecuteChangeSet",
                "cloudformation:GetTemplate"
              ],
              "Resource": {
                "Ref": "StackNames"
              }
            },
            {
              "Effect": "Allow",
              "Action": [
                "cloudfront:GetDistribution",
                "cloudfront:GetDistributionConfig",
                "cloudfront:UpdateDistribution"
              ],
              "Resource": {
                "Ref": "StackDistributions"
              }
            },
            {
              "Effect": "Allow",
              "Action": [
                "ecs:DescribeServices",
                "ecs:UpdateService"
              ],
              "Resource": {
                  "Ref": "StackServices"
              }
            }
            {
              "Effect": "Allow",
              "Action": [
                "ec2:DescribeSubnets",
                "ecs:DescribeClusters",
                "ecs:RegisterTaskDefinition",
                "ec2:DescribeVpcs"
              ],
              "Resource": "*"
            },
            {
              "Sid": "VisualEditor2",
              "Effect": "Allow",
              "Action": [
                "iam:PassRole"
              ],
              "Resource": [
                "arn:aws:iam::951168128976:role/ecsTaskExecutionRole"
              ]
            }
          ]
        }
      }
    }
  },
  "Parameters": {
    "StackNames": {
      "Type": "CommaDelimitedList",
      "Description": "List of all stacks to be accessible for update. TODO(cyrille): Create a macro to get those directly from the stack names.",
      "Default": "arn:aws:cloudformation:eu-west-3:951168128976:stack/bob-fr/*,arn:aws:cloudformation:eu-west-3:951168128976:stack/bob-t-pro/*,arn:aws:cloudformation:eu-west-3:951168128976:stack/bob-youzful/*,arn:aws:cloudformation:us-east-1:951168128976:stack/bob-skillup/*,arn:aws:cloudformation:us-east-1:951168128976:stack/bob-us/*,arn:aws:cloudformation:eu-west-2:951168128976:stack/bob-uk/*,arn:aws:cloudformation:eu-west-3:951168128976:stack/bob-fr-jobflix/*,arn:aws:cloudformation:eu-west-3:951168128976:stack/bob-t-pro-jobflix/*"
    },
    "StackServices": {
      "Type": "CommaDelimitedList",
      "Description": "List of all ECSServices to be accessible for update. TODO(cyrille): Create a macro to get those directly from the stack names.",
      "Default": "arn:aws:ecs:eu-west-3:951168128976:service/bob-fr-ECSCluster-81UmFvZUQNau/bob-fr-ECSService-1KNCYTLTHMR4H,arn:aws:ecs:eu-west-3:951168128976:service/bob-t-pro-ECSCluster-vT4ZBwvBCDl0/bob-t-pro-ECSService-xvTVxhuiC0bI,arn:aws:ecs:eu-west-3:951168128976:service/bob-youzful-ECSCluster-2npAmF4rT3aU/bob-youzful-ECSService-oqdAM21rha9V,arn:aws:ecs:us-east-1:951168128976:service/bob-skillup-ECSCluster-nXAqS9Xqbqlk/bob-skillup-ECSService-h8q9u5FsFFxQ,arn:aws:ecs:us-east-1:951168128976:service/bob-us-ECSService-MN39WAE8W7QK,arn:aws:ecs:eu-west-2:951168128976:service/bob-uk-ECSService-ICR7X5T58K8W"
    },
    "StackDistributions": {
      "Type": "CommaDelimitedList",
      "Description": "List of all Cloudfront distributions to be accessible for update. TODO(cyrille): Create a macro to get those directly from the stack names.",
      "Default": "arn:aws:cloudfront::951168128976:distribution/E1MR4UGXZI2M6J,arn:aws:cloudfront::951168128976:distribution/E2S9MM9J8ZXTIZ,arn:aws:cloudfront::951168128976:distribution/E3EYRUOGD2Q9EF,arn:aws:cloudfront::951168128976:distribution/EUQJV1K8DFBAZ,arn:aws:cloudfront::951168128976:distribution/E37J7P0ZGRNGMR,arn:aws:cloudfront::951168128976:distribution/EW0EBF68ZVMCC,arn:aws:cloudfront::951168128976:distribution/ESNEY2397EVJ3,arn:aws:cloudfront::951168128976:distribution/ERI0JU4EUM6XL"
    }
  }
}
